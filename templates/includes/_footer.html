<footer class="footer custom-darker-blue-bg mt-auto">
    <div class="container-fluid  text-white py-5">
    <div class="row">
        <div class="col-sm-3">
            <h3 class="text-white mb-4">Account</h3>
            <ul class="list-unstyled" >
                <li ><a style="color:#DDD;" href="/user/profile" class=" hover-link">Your Account</a></li>
                <li><a style="color:#DDD;" href="/user/profile/edit" class=" hover-link">Edit Account</a></li>
                <li><a  style="color:#DDD;" href="/yourOrders" class=" hover-link">Your Orders</a></li>
            </ul>
        </div>
        <div class="col-sm-3">
            <h3 class="text-white  mb-4">Socials</h3>
            <ul class="list-unstyled">
                <li><a style="color:#DDD;" href="https://x.com/?mx=2" class=" hover-link">Twitter</a></li>
                <li><a style="color:#DDD;" href="https://www.instagram.com/" class=" hover-link">Instagram</a></li>
                <li><a style="color:#DDD;" href="https://www.facebook.com/" class=" hover-link">Facebook</a></li>
            </ul>
        </div>
        <div class="col-sm-3">
            <h3 class="text-white  mb-4">Support</h3>
            <ul class="list-unstyled">

                <li><a style="color:#DDD;" href="/contact/add" class=" hover-link">Contact us</a></li>
                <li><a style="color:#DDD;" href="/faq" class=" hover-link">FAQ</a></li>
            </ul>
        </div>
    </div>
</div>
    <a class="rounded-circle d-flex align-items-center justify-content-center" id="chatbot-button"><img
            style="max-height: 50px;" src="{{ url_for('static', filename='images/John_Placeholder.png') }}"></a>
    <div class="input-group mb-3  " id="chatboxer">

        <div id="top-chat" style="position: sticky;top: 0px;opacity: 0.95;" class=" d-flex align-items-center"><h3>Neuro</h3><a id="x"><img class="img-fluid"
                                                                                           style="max-height: 20px;"
                                                                                           src="{{ url_for('static', filename='images/close.png') }}"></a>
        </div>
        <div id="chatbox"></div>
        <div class="chatbox-texting ">
            <div style="display:flex;position: absolute;">
                <input type="text" class="form-control " placeholder="How can i help you?"
                       aria-label="User-prompt" aria-describedby="button-addon2" id="user_input"
                       >
                <button id="chatbot-enter" class="btn btn-info rounded-end" type="button">Send</button>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>

    <script type="module">
        import { sanitizeInput } from '/static/javascripts/sanitize.js';
        document.getElementById('chatbot-button').addEventListener('click', function() {
            const chatbox = document.getElementById('chatboxer');
            chatbox.style.display = 'block';  // Open chatbox
        });
        document.getElementById('x').addEventListener('click', function() {
            const chatbox = document.getElementById('chatboxer');
            chatbox.style.display = 'none';  // Close chatbox
        });
        document.getElementById('chatbot-enter').addEventListener('click', function() {
            let user_input = sanitizeInput(document.getElementById('user_input').value); // Sanitize user input

            if (user_input) {
                let chatbox = document.getElementById('chatbox');
                chatbox.innerHTML += '<div class="user-message">' + user_input + '</div>'; // add user input
                let thinkingMessage = '<div class="bot-response thinking" name="think">Thinking...</div>';
                chatbox.innerHTML += thinkingMessage;
                chatbox.scrollTop = chatbox.scrollHeight;

                // Send the input to the server via AJAX
                fetch('/chatbot', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                    body: 'user_input=' + encodeURIComponent(user_input)
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data.response);
                    let botResponseHtml = DOMPurify.sanitize(marked.parse(data.response), {
        USE_PROFILES: { html: true }});
                    console.log(botResponseHtml);
                    let thinkingElement = document.querySelector('.thinking');
                        if (thinkingElement) {
                            thinkingElement.outerHTML = '<div class="bot-response">' + botResponseHtml + '</div>';
                        }
                    chatbox.scrollTop = chatbox.scrollHeight;
                });

                // Clear input field
                document.getElementById('user_input').value = '';
            }
        });

    </script>

</footer>
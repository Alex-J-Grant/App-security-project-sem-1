{% extends "base.html" %}

{% block title %}Profile Edit{% endblock %}

{% block content %}
<h1>Edit Your Details!</h1>

<form method="POST" enctype="multipart/form-data">
  {{ form.hidden_tag() }}

  <div class="row">
    <!-- Left column: user details -->
    <div class="col-md-8">
      <p>
        {{ form.username.label }}<br>
        {{ form.username(size=32) }}
        {% if form.username.errors %}
          <ul class="text-danger">
          {% for error in form.username.errors %}
            <li>{{ error }}</li>
          {% endfor %}
          </ul>
        {% endif %}
      </p>

      <p>
        {{ form.fname.label }}<br>
        {{ form.fname(size=32) }}
        {% if form.fname.errors %}
          <ul class="text-danger">
          {% for error in form.fname.errors %}
            <li>{{ error }}</li>
          {% endfor %}
          </ul>
        {% endif %}
      </p>

      <p>
        {{ form.lname.label }}<br>
        {{ form.lname(size=32) }}
        {% if form.lname.errors %}
          <ul class="text-danger">
          {% for error in form.lname.errors %}
            <li>{{ error }}</li>
          {% endfor %}
          </ul>
        {% endif %}
      </p>

      <p>
        {{ form.email.label }}<br>
        {{ form.email(size=32) }}
        {% if form.email.errors %}
          <ul class="text-danger">
          {% for error in form.email.errors %}
            <li>{{ error }}</li>
          {% endfor %}
          </ul>
        {% endif %}
      </p>

      <p>
        {{ form.telno.label }}<br>
        {{ form.telno() }}
        {% if form.telno.errors %}
          <ul class="text-danger">
          {% for error in form.telno.errors %}
            <li>{{ error }}</li>
          {% endfor %}
          </ul>
        {% endif %}
      </p>

      <p>
        {{ form.address.label }}<br>
        {{ form.address(size=32) }}
        {% if form.address.errors %}
          <ul class="text-danger">
          {% for error in form.address.errors %}
            <li>{{ error }}</li>
          {% endfor %}
          </ul>
        {% endif %}
      </p>

      <p>
        {{ form.postal.label }}<br>
        {{ form.postal() }}
        {% if form.postal.errors %}
          <ul class="text-danger">
          {% for error in form.postal.errors %}
            <li>{{ error }}</li>
          {% endfor %}
          </ul>
        {% endif %}
      </p>

      <hr>
      <h3>Change Password</h3>

      <p>
        {{ form.curr_password.label }}<br>
        {{ form.curr_password() }}
        {% if form.curr_password.errors %}
          <ul class="text-danger">
          {% for error in form.curr_password.errors %}
            <li>{{ error }}</li>
          {% endfor %}
          </ul>
        {% endif %}
      </p>

      <p>
        {{ form.password.label }}<br>
        {{ form.password(size=32) }}
        {% if form.password.errors %}
          <ul class="text-danger">
          {% for error in form.password.errors %}
            <li>{{ error }}</li>
          {% endfor %}
          </ul>
        {% endif %}
      </p>

      <p>
        {{ form.confirm_pw.label }}<br>
        {{ form.confirm_pw(size=32) }}
        {% if form.confirm_pw.errors %}
          <ul class="text-danger">
          {% for error in form.confirm_pw.errors %}
            <li>{{ error }}</li>
          {% endfor %}
          </ul>
        {% endif %}
      </p>

      <p>{{ form.submit(class="btn btn-primary") }}</p>
      <a href="{{ url_for('profile.delete') }}" class="btn btn-danger">Delete Your Account</a>
    </div>

    <!-- Right column: profile picture -->
    <div class="col-md-4">
      <h3>Profile Picture</h3>
      {% if current_user.userpfp %}
        <img src="{{ url_for('static', filename='profile_pics/' ~ current_user.userpfp) }}" 
             alt="Profile Picture" class="img-thumbnail mb-3" style="max-width:100%;">
      {% else %}
        <p>No profile picture uploaded yet.</p>
      {% endif %}

      <p>
        {{ form.pfp.label }}<br>
        {{ form.pfp() }}
        {% if form.pfp.errors %}
          <ul class="text-danger">
          {% for error in form.pfp.errors %}
            <li>{{ error }}</li>
          {% endfor %}
          </ul>
        {% endif %}
      </p>
    </div>
  </div>
</form>
{% endblock %}

